<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель - WoodAdvent</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #1A237E;
            --secondary-color: #283593;
            --accent-color: #5C6BC0;
            --light-color: #E8EAF6;
            --dark-color: #0D1B2A;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --error-color: #F44336;
            --processing-color: #2196F3;
            --completed-color: #4CAF50;
            --pending-color: #FF9800;
            --cancelled-color: #F44336;
        }
        
        body {
            background: linear-gradient(135deg, #E3F2FD 0%, #F3E5F5 100%);
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 20px rgba(26, 35, 126, 0.3);
        }
        
        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: bold;
            text-decoration: none;
            color: white;
        }
        
        .logo i {
            color: var(--light-color);
        }
        
        .admin-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .admin-name {
            font-weight: 500;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Dashboard */
        .dashboard {
            padding: 2rem 0;
        }
        
        .dashboard-header {
            margin-bottom: 2rem;
        }
        
        .dashboard-title {
            font-size: 2.2rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .dashboard-subtitle {
            color: #666;
            font-size: 1.1rem;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s;
            border-left: 4px solid;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card.total {
            border-left-color: var(--primary-color);
        }
        
        .stat-card.processing {
            border-left-color: var(--processing-color);
        }
        
        .stat-card.completed {
            border-left-color: var(--completed-color);
        }
        
        .stat-card.pending {
            border-left-color: var(--pending-color);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .stat-icon.total {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        }
        
        .stat-icon.processing {
            background: linear-gradient(135deg, var(--processing-color), #42A5F5);
        }
        
        .stat-icon.completed {
            background: linear-gradient(135deg, var(--completed-color), #66BB6A);
        }
        
        .stat-icon.pending {
            background: linear-gradient(135deg, var(--pending-color), #FFB74D);
        }
        
        .stat-content h3 {
            font-size: 2rem;
            margin-bottom: 0.2rem;
        }
        
        .stat-content p {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Controls */
        .controls {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            justify-content: space-between;
        }
        
        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 3rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }
        
        .filter-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 0.6rem 1.2rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn:hover {
            background: var(--light-color);
        }
        
        .filter-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .date-filter {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .date-filter input {
            padding: 0.6rem;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        /* Orders Table */
        .orders-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .section-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-header h2 {
            color: var(--primary-color);
        }
        
        .orders-count {
            background: var(--light-color);
            color: var(--primary-color);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .orders-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .orders-table th {
            background: var(--light-color);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--primary-color);
            border-bottom: 2px solid #ddd;
        }
        
        .orders-table td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }
        
        .orders-table tr:hover {
            background: #f9f9f9;
        }
        
        .order-id {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .order-date {
            color: #666;
            font-size: 0.9rem;
        }
        
        .customer-info {
            font-size: 0.9rem;
        }
        
        .customer-name {
            font-weight: 600;
            margin-bottom: 0.2rem;
        }
        
        .customer-phone {
            color: #666;
        }
        
        .items-list {
            font-size: 0.9rem;
            max-width: 200px;
        }
        
        .item-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.3rem;
        }
        
        .item-name {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 120px;
        }
        
        .item-quantity {
            color: #666;
        }
        
        .order-total {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .status-processing {
            background: rgba(33, 150, 243, 0.1);
            color: var(--processing-color);
        }
        
        .status-completed {
            background: rgba(76, 175, 80, 0.1);
            color: var(--completed-color);
        }
        
        .status-pending {
            background: rgba(255, 152, 0, 0.1);
            color: var(--pending-color);
        }
        
        .status-cancelled {
            background: rgba(244, 67, 54, 0.1);
            color: var(--cancelled-color);
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-view {
            background: var(--light-color);
            color: var(--primary-color);
        }
        
        .btn-view:hover {
            background: #e1e5f9;
        }
        
        .btn-process {
            background: rgba(33, 150, 243, 0.1);
            color: var(--processing-color);
        }
        
        .btn-process:hover {
            background: rgba(33, 150, 243, 0.2);
        }
        
        .btn-complete {
            background: rgba(76, 175, 80, 0.1);
            color: var(--completed-color);
        }
        
        .btn-complete:hover {
            background: rgba(76, 175, 80, 0.2);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.3s ease;
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            color: var(--primary-color);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: var(--error-color);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .order-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .detail-section {
            margin-bottom: 2rem;
        }
        
        .detail-section h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-color);
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px dashed #eee;
        }
        
        .detail-label {
            color: #666;
            font-weight: 500;
        }
        
        .detail-value {
            text-align: right;
            max-width: 200px;
        }
        
        .items-details {
            margin-top: 1rem;
        }
        
        .item-detail {
            background: var(--light-color);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .modal-actions {
            padding: 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary:hover {
            background: var(--secondary-color);
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-secondary:hover {
            background: var(--light-color);
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            padding: 1.5rem;
            border-top: 1px solid #eee;
        }
        
        .page-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .page-btn:hover {
            background: var(--light-color);
        }
        
        .page-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1001;
            transform: translateX(150%);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border-left: 4px solid;
        }
        
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .notification.success {
            border-left-color: var(--success-color);
        }
        
        .notification.error {
            border-left-color: var(--error-color);
        }
        
        .notification.warning {
            border-left-color: var(--warning-color);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }
        
        .empty-state i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 1rem;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .orders-table {
                display: block;
                overflow-x: auto;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .order-details-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-actions {
                flex-direction: column;
            }
            
            .modal-actions button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">
                    <i class="fas fa-tools"></i>
                    <span>WoodAdvent Admin</span>
                </a>
                
                <div class="admin-info">
                    <div class="admin-name">
                        <i class="fas fa-user-circle"></i> Администратор
                    </div>
                    <button class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Выйти
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Dashboard -->
    <section class="dashboard">
        <div class="container">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Панель управления заказами</h1>
                <p class="dashboard-subtitle">Управляйте заказами на новогодние календари</p>
            </div>
            
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card total">
                    <div class="stat-icon total">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-orders">0</h3>
                        <p>Всего заказов</p>
                    </div>
                </div>
                
                <div class="stat-card processing">
                    <div class="stat-icon processing">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="processing-orders">0</h3>
                        <p>В обработке</p>
                    </div>
                </div>
                
                <div class="stat-card completed">
                    <div class="stat-icon completed">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="completed-orders">0</h3>
                        <p>Завершено</p>
                    </div>
                </div>
                
                <div class="stat-card pending">
                    <div class="stat-icon pending">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="pending-orders">0</h3>
                        <p>Ожидают</p>
                    </div>
                </div>
            </div>
            
            <!-- Controls -->
            <div class="controls">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="Поиск по ID, имени, телефону...">
                </div>
                
                <div class="filter-group">
                    <button class="filter-btn active" data-filter="all">Все</button>
                    <button class="filter-btn" data-filter="processing">В обработке</button>
                    <button class="filter-btn" data-filter="completed">Завершены</button>
                    <button class="filter-btn" data-filter="pending">Ожидают</button>
                    <button class="filter-btn" data-filter="cancelled">Отменены</button>
                </div>
                
                <div class="date-filter">
                    <input type="date" id="date-from">
                    <span>—</span>
                    <input type="date" id="date-to">
                </div>
            </div>
            
            <!-- Orders Table -->
            <div class="orders-section">
                <div class="section-header">
                    <h2>Заказы</h2>
                    <span class="orders-count" id="orders-count">0 заказов</span>
                </div>
                
                <div class="table-container">
                    <table class="orders-table">
                        <thead>
                            <tr>
                                <th style="width: 120px;">ID заказа</th>
                                <th style="width: 150px;">Дата</th>
                                <th style="width: 200px;">Клиент</th>
                                <th style="width: 250px;">Товары</th>
                                <th style="width: 120px;">Сумма</th>
                                <th style="width: 120px;">Статус</th>
                                <th style="width: 180px;">Действия</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table-body">
                            <!-- Orders will be loaded here -->
                        </tbody>
                    </table>
                </div>
                
                <div id="empty-state" class="empty-state" style="display: none;">
                    <i class="fas fa-clipboard-list"></i>
                    <h3>Заказы не найдены</h3>
                    <p>По вашему запросу нет заказов</p>
                </div>
                
                <div class="pagination" id="pagination">
                    <!-- Pagination will be generated here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Order Details Modal -->
    <div class="modal" id="order-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Детали заказа <span id="modal-order-id"></span></h3>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="order-details-grid">
                    <div>
                        <div class="detail-section">
                            <h4>Информация о клиенте</h4>
                            <div class="detail-row">
                                <span class="detail-label">Имя:</span>
                                <span class="detail-value" id="modal-customer-name"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Телефон:</span>
                                <span class="detail-value" id="modal-customer-phone"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Email:</span>
                                <span class="detail-value" id="modal-customer-email"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Адрес:</span>
                                <span class="detail-value" id="modal-customer-address"></span>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4>Детали заказа</h4>
                            <div class="detail-row">
                                <span class="detail-label">Дата заказа:</span>
                                <span class="detail-value" id="modal-order-date"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Статус:</span>
                                <span class="detail-value">
                                    <span id="modal-order-status" class="status-badge"></span>
                                </span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Комментарий:</span>
                                <span class="detail-value" id="modal-order-comment"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="detail-section">
                            <h4>Товары в заказе</h4>
                            <div class="items-details" id="modal-items-list">
                                <!-- Items will be loaded here -->
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4>Финансовая информация</h4>
                            <div class="detail-row">
                                <span class="detail-label">Товары:</span>
                                <span class="detail-value" id="modal-subtotal"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Доставка:</span>
                                <span class="detail-value" id="modal-delivery"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Скидка:</span>
                                <span class="detail-value" id="modal-discount"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Итого:</span>
                                <span class="detail-value" id="modal-total" style="font-weight: bold; color: var(--primary-color);"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn-secondary" id="btn-print">
                    <i class="fas fa-print"></i> Печать
                </button>
                <div class="action-buttons">
                    <button class="btn-secondary" id="btn-cancel">Отменить</button>
                    <button class="btn-primary" id="btn-process">
                        <i class="fas fa-cogs"></i> В обработку
                    </button>
                    <button class="btn-primary" id="btn-complete">
                        <i class="fas fa-check"></i> Завершить
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle" id="notification-icon"></i>
        <span id="notification-text"></span>
    </div>

    <script>
        // Mock database for demonstration
        // In real app, this would be connected to a backend
        class OrderDatabase {
            constructor() {
                this.orders = this.loadOrders();
                this.currentOrderId = this.loadCurrentOrderId();
            }
            
            loadOrders() {
                const savedOrders = localStorage.getItem('woodadvent_orders');
                return savedOrders ? JSON.parse(savedOrders) : this.getMockOrders();
            }
            
            loadCurrentOrderId() {
                return parseInt(localStorage.getItem('woodadvent_current_order_id') || '1000');
            }
            
            saveOrders() {
                localStorage.setItem('woodadvent_orders', JSON.stringify(this.orders));
                localStorage.setItem('woodadvent_current_order_id', this.currentOrderId.toString());
            }
            
            getMockOrders() {
                // Generate some mock orders for demonstration
                return [
                    {
                        id: 'WD-2024-1001',
                        date: '2024-12-01',
                        customer: {
                            name: 'Иванов Александр',
                            phone: '+7 (987) 654-32-10',
                            email: 'ivanov@example.com',
                            address: 'Москва, ул. Тверская, д. 10, кв. 25'
                        },
                        items: [
                            { id: 1, name: 'Новогодний домик "Сказочный лес"', price: 7999, quantity: 1, color: '#2E7D32' },
                            { id: 2, name: 'Календарь-елка "Золотая хвоя"', price: 8799, quantity: 1, color: '#FFA000' }
                        ],
                        subtotal: 16798,
                        delivery: 500,
                        discount: 2519.7,
                        discountCode: 'NEWYEAR24',
                        total: 14778.3,
                        comment: 'Пожалуйста, позвонить за час до доставки',
                        status: 'processing'
                    },
                    {
                        id: 'WD-2024-1002',
                        date: '2024-12-02',
                        customer: {
                            name: 'Петрова Мария',
                            phone: '+7 (912) 345-67-89',
                            email: 'petrova@example.com',
                            address: 'Санкт-Петербург, Невский пр., д. 45'
                        },
                        items: [
                            { id: 4, name: 'Календарь с именной гравировкой', price: 9499, quantity: 2, color: '#1B5E20' }
                        ],
                        subtotal: 18998,
                        delivery: 500,
                        discount: 0,
                        discountCode: '',
                        total: 19498,
                        comment: 'Гравировка: "Семье Петровых с любовью"',
                        status: 'pending'
                    },
                    {
                        id: 'WD-2024-1003',
                        date: '2024-11-28',
                        customer: {
                            name: 'Сидоров Дмитрий',
                            phone: '+7 (905) 123-45-67',
                            email: 'sidorov@example.com',
                            address: 'Екатеринбург, ул. Ленина, д. 33, кв. 12'
                        },
                        items: [
                            { id: 3, name: 'Сундук "Новогодние сокровища"', price: 13999, quantity: 1, color: '#FF8F00' }
                        ],
                        subtotal: 13999,
                        delivery: 500,
                        discount: 1400,
                        discountCode: 'SANTA2024',
                        total: 13099,
                        comment: '',
                        status: 'completed'
                    },
                    {
                        id: 'WD-2024-1004',
                        date: '2024-11-30',
                        customer: {
                            name: 'Козлова Анна',
                            phone: '+7 (999) 888-77-66',
                            email: 'kozlova@example.com',
                            address: 'Казань, ул. Баумана, д. 15'
                        },
                        items: [
                            { id: 5, name: 'Трехэтажный домик "Зимняя сказка"', price: 17999, quantity: 1, color: '#D32F2F' },
                            { id: 1, name: 'Новогодний домик "Сказочный лес"', price: 7999, quantity: 1, color: '#2E7D32' }
                        ],
                        subtotal: 25998,
                        delivery: 500,
                        discount: 5200,
                        discountCode: 'GIFT10',
                        total: 21298,
                        comment: 'Нужно доставить до 20 декабря',
                        status: 'cancelled'
                    }
                ];
            }
            
            addOrder(orderData) {
                // Generate order ID
                this.currentOrderId++;
                const orderId = `WD-2024-${this.currentOrderId}`;
                
                // Create order object
                const order = {
                    id: orderId,
                    date: new Date().toISOString().split('T')[0],
                    customer: {
                        name: orderData.name,
                        phone: orderData.phone,
                        email: orderData.email,
                        address: orderData.address
                    },
                    items: orderData.items,
                    subtotal: orderData.total,
                    delivery: 500,
                    discount: orderData.discount || 0,
                    discountCode: orderData.discountCode || '',
                    total: orderData.total + 500 - (orderData.discount || 0),
                    comment: orderData.comment || '',
                    status: 'pending'
                };
                
                // Add to orders
                this.orders.unshift(order);
                this.saveOrders();
                
                return orderId;
            }
            
            getOrders(filter = 'all', search = '', dateFrom = '', dateTo = '') {
                let filteredOrders = [...this.orders];
                
                // Apply status filter
                if (filter !== 'all') {
                    filteredOrders = filteredOrders.filter(order => order.status === filter);
                }
                
                // Apply search
                if (search) {
                    const searchLower = search.toLowerCase();
                    filteredOrders = filteredOrders.filter(order => 
                        order.id.toLowerCase().includes(searchLower) ||
                        order.customer.name.toLowerCase().includes(searchLower) ||
                        order.customer.phone.includes(search) ||
                        order.customer.email.toLowerCase().includes(searchLower)
                    );
                }
                
                // Apply date filter
                if (dateFrom) {
                    filteredOrders = filteredOrders.filter(order => order.date >= dateFrom);
                }
                if (dateTo) {
                    filteredOrders = filteredOrders.filter(order => order.date <= dateTo);
                }
                
                return filteredOrders;
            }
            
            getOrderById(orderId) {
                return this.orders.find(order => order.id === orderId);
            }
            
            updateOrderStatus(orderId, newStatus) {
                const order = this.getOrderById(orderId);
                if (order) {
                    order.status = newStatus;
                    this.saveOrders();
                    return true;
                }
                return false;
            }
            
            deleteOrder(orderId) {
                const index = this.orders.findIndex(order => order.id === orderId);
                if (index !== -1) {
                    this.orders.splice(index, 1);
                    this.saveOrders();
                    return true;
                }
                return false;
            }
            
            getStats() {
                const total = this.orders.length;
                const processing = this.orders.filter(o => o.status === 'processing').length;
                const completed = this.orders.filter(o => o.status === 'completed').length;
                const pending = this.orders.filter(o => o.status === 'pending').length;
                const cancelled = this.orders.filter(o => o.status === 'cancelled').length;
                
                return { total, processing, completed, pending, cancelled };
            }
            
            formatPrice(price) {
                return new Intl.NumberFormat('ru-RU').format(price) + ' ₽';
            }
            
            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('ru-RU');
            }
        }

        // Admin Panel Class
        class AdminPanel {
            constructor() {
                this.db = new OrderDatabase();
                this.currentFilter = 'all';
                this.currentPage = 1;
                this.ordersPerPage = 10;
                this.currentOrder = null;
                
                this.init();
            }
            
            init() {
                // Load and display orders
                this.loadOrders();
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Listen for new orders from main site
                this.setupStorageListener();
                
                // Listen for messages from main site
                window.addEventListener('message', (event) => {
                    if (event.data.type === 'newOrder') {
                        this.showNotification(`Новый заказ: ${event.data.orderId}`, 'success');
                        this.loadOrders();
                    }
                });
            }
            
            setupEventListeners() {
                // Filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const filter = e.target.dataset.filter;
                        this.setFilter(filter);
                    });
                });
                
                // Search input
                document.getElementById('search-input').addEventListener('input', (e) => {
                    this.searchOrders(e.target.value);
                });
                
                // Date filters
                document.getElementById('date-from').addEventListener('change', () => {
                    this.applyDateFilter();
                });
                
                document.getElementById('date-to').addEventListener('change', () => {
                    this.applyDateFilter();
                });
                
                // Logout button
                document.querySelector('.logout-btn').addEventListener('click', () => {
                    if (confirm('Выйти из админ-панели?')) {
                        window.location.href = 'index.html';
                    }
                });
                
                // Close modal
                document.getElementById('close-modal').addEventListener('click', () => {
                    this.closeModal();
                });
                
                // Modal actions
                document.getElementById('btn-print').addEventListener('click', () => {
                    this.printOrder();
                });
                
                document.getElementById('btn-process').addEventListener('click', () => {
                    this.updateOrderStatus('processing');
                });
                
                document.getElementById('btn-complete').addEventListener('click', () => {
                    this.updateOrderStatus('completed');
                });
                
                document.getElementById('btn-cancel').addEventListener('click', () => {
                    this.cancelOrder();
                });
                
                // Close modal on outside click
                document.getElementById('order-modal').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('order-modal')) {
                        this.closeModal();
                    }
                });
            }
            
            setupStorageListener() {
                // Listen for new orders in localStorage
                let lastOrderCount = this.db.orders.length;
                
                setInterval(() => {
                    const currentCount = this.db.orders.length;
                    if (currentCount > lastOrderCount) {
                        this.showNotification('Поступил новый заказ!', 'success');
                        this.loadOrders();
                    }
                    lastOrderCount = currentCount;
                }, 1000);
            }
            
            loadOrders() {
                const orders = this.db.getOrders(this.currentFilter);
                this.updateStats();
                this.renderOrdersTable(orders);
                this.updatePagination(orders.length);
            }
            
            updateStats() {
                const stats = this.db.getStats();
                
                document.getElementById('total-orders').textContent = stats.total;
                document.getElementById('processing-orders').textContent = stats.processing;
                document.getElementById('completed-orders').textContent = stats.completed;
                document.getElementById('pending-orders').textContent = stats.pending;
            }
            
            renderOrdersTable(orders) {
                const tbody = document.getElementById('orders-table-body');
                const emptyState = document.getElementById('empty-state');
                
                if (orders.length === 0) {
                    tbody.innerHTML = '';
                    emptyState.style.display = 'block';
                    return;
                }
                
                emptyState.style.display = 'none';
                
                // Calculate pagination
                const startIndex = (this.currentPage - 1) * this.ordersPerPage;
                const endIndex = startIndex + this.ordersPerPage;
                const pagedOrders = orders.slice(startIndex, endIndex);
                
                let html = '';
                
                pagedOrders.forEach(order => {
                    // Calculate total items count
                    const totalItems = order.items.reduce((sum, item) => sum + item.quantity, 0);
                    
                    // Get status badge class
                    const statusClass = `status-${order.status}`;
                    const statusText = this.getStatusText(order.status);
                    
                    html += `
                        <tr data-order-id="${order.id}">
                            <td>
                                <div class="order-id">${order.id}</div>
                            </td>
                            <td>
                                <div class="order-date">${this.db.formatDate(order.date)}</div>
                            </td>
                            <td>
                                <div class="customer-info">
                                    <div class="customer-name">${order.customer.name}</div>
                                    <div class="customer-phone">${order.customer.phone}</div>
                                </div>
                            </td>
                            <td>
                                <div class="items-list">
                                    ${order.items.slice(0, 2).map(item => `
                                        <div class="item-row">
                                            <span class="item-name">${item.name}</span>
                                            <span class="item-quantity">×${item.quantity}</span>
                                        </div>
                                    `).join('')}
                                    ${order.items.length > 2 ? 
                                        `<div class="item-row">
                                            <span class="item-name">и еще ${order.items.length - 2} товара</span>
                                        </div>` : ''
                                    }
                                    <div class="item-row" style="margin-top: 0.5rem;">
                                        <span>Всего: ${totalItems} шт.</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="order-total">${this.db.formatPrice(order.total)}</div>
                            </td>
                            <td>
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn btn-view view-order" data-order-id="${order.id}">
                                        <i class="fas fa-eye"></i> Просмотр
                                    </button>
                                    ${order.status === 'pending' ? `
                                        <button class="action-btn btn-process process-order" data-order-id="${order.id}">
                                            <i class="fas fa-cogs"></i> Взять
                                        </button>
                                    ` : ''}
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                
                // Update orders count
                document.getElementById('orders-count').textContent = `${orders.length} заказ${orders.length % 10 === 1 ? '' : (orders.length % 10 >= 2 && orders.length % 10 <= 4 ? 'а' : 'ов')}`;
                
                // Attach event listeners to new buttons
                this.attachTableEventListeners();
            }
            
            attachTableEventListeners() {
                // View order buttons
                document.querySelectorAll('.view-order').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const orderId = e.target.closest('button').dataset.orderId;
                        this.showOrderDetails(orderId);
                    });
                });
                
                // Process order buttons
                document.querySelectorAll('.process-order').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const orderId = e.target.closest('button').dataset.orderId;
                        this.updateOrderStatus('processing', orderId);
                    });
                });
            }
            
            updatePagination(totalOrders) {
                const pagination = document.getElementById('pagination');
                const totalPages = Math.ceil(totalOrders / this.ordersPerPage);
                
                if (totalPages <= 1) {
                    pagination.innerHTML = '';
                    return;
                }
                
                let html = '';
                
                // Previous button
                html += `
                    <button class="page-btn prev-page" ${this.currentPage === 1 ? 'disabled' : ''}>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                `;
                
                // Page numbers
                const maxVisiblePages = 5;
                let startPage = Math.max(1, this.currentPage - Math.floor(maxVisiblePages / 2));
                let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
                
                if (endPage - startPage + 1 < maxVisiblePages) {
                    startPage = Math.max(1, endPage - maxVisiblePages + 1);
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    html += `
                        <button class="page-btn ${i === this.currentPage ? 'active' : ''}" data-page="${i}">
                            ${i}
                        </button>
                    `;
                }
                
                // Next button
                html += `
                    <button class="page-btn next-page" ${this.currentPage === totalPages ? 'disabled' : ''}>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                `;
                
                pagination.innerHTML = html;
                
                // Attach pagination event listeners
                document.querySelectorAll('.page-btn:not(.prev-page):not(.next-page)').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const page = parseInt(e.target.dataset.page);
                        this.goToPage(page);
                    });
                });
                
                document.querySelector('.prev-page')?.addEventListener('click', () => {
                    if (this.currentPage > 1) {
                        this.goToPage(this.currentPage - 1);
                    }
                });
                
                document.querySelector('.next-page')?.addEventListener('click', () => {
                    if (this.currentPage < totalPages) {
                        this.goToPage(this.currentPage + 1);
                    }
                });
            }
            
            goToPage(page) {
                this.currentPage = page;
                this.loadOrders();
                
                // Scroll to top of table
                document.querySelector('.orders-section').scrollIntoView({ behavior: 'smooth' });
            }
            
            setFilter(filter) {
                this.currentFilter = filter;
                this.currentPage = 1;
                
                // Update active filter button
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.filter === filter) {
                        btn.classList.add('active');
                    }
                });
                
                this.loadOrders();
            }
            
            searchOrders(query) {
                this.currentPage = 1;
                this.loadOrders();
            }
            
            applyDateFilter() {
                const dateFrom = document.getElementById('date-from').value;
                const dateTo = document.getElementById('date-to').value;
                
                this.currentPage = 1;
                this.loadOrders();
            }
            
            showOrderDetails(orderId) {
                const order = this.db.getOrderById(orderId);
                if (!order) return;
                
                this.currentOrder = order;
                
                // Populate modal
                document.getElementById('modal-order-id').textContent = order.id;
                document.getElementById('modal-customer-name').textContent = order.customer.name;
                document.getElementById('modal-customer-phone').textContent = order.customer.phone;
                document.getElementById('modal-customer-email').textContent = order.customer.email;
                document.getElementById('modal-customer-address').textContent = order.customer.address;
                document.getElementById('modal-order-date').textContent = this.db.formatDate(order.date);
                document.getElementById('modal-order-comment').textContent = order.comment || '—';
                document.getElementById('modal-subtotal').textContent = this.db.formatPrice(order.subtotal);
                document.getElementById('modal-delivery').textContent = this.db.formatPrice(order.delivery);
                document.getElementById('modal-discount').textContent = order.discount > 0 ? 
                    `-${this.db.formatPrice(order.discount)} (${order.discountCode})` : '—';
                document.getElementById('modal-total').textContent = this.db.formatPrice(order.total);
                
                // Status badge
                const statusBadge = document.getElementById('modal-order-status');
                statusBadge.textContent = this.getStatusText(order.status);
                statusBadge.className = `status-badge status-${order.status}`;
                
                // Items list
                const itemsList = document.getElementById('modal-items-list');
                itemsList.innerHTML = order.items.map(item => `
                    <div class="item-detail">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <strong>${item.name}</strong>
                            <span>${this.db.formatPrice(item.price)} × ${item.quantity}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #666;">Артикул: ${item.id}</span>
                            <strong>${this.db.formatPrice(item.price * item.quantity)}</strong>
                        </div>
                    </div>
                `).join('');
                
                // Show/hide action buttons based on status
                this.updateActionButtons(order.status);
                
                // Show modal
                document.getElementById('order-modal').style.display = 'flex';
            }
            
            updateActionButtons(status) {
                const processBtn = document.getElementById('btn-process');
                const completeBtn = document.getElementById('btn-complete');
                const cancelBtn = document.getElementById('btn-cancel');
                
                // Reset all buttons
                processBtn.style.display = 'inline-flex';
                completeBtn.style.display = 'inline-flex';
                cancelBtn.style.display = 'inline-flex';
                
                switch (status) {
                    case 'pending':
                        processBtn.style.display = 'inline-flex';
                        completeBtn.style.display = 'none';
                        cancelBtn.textContent = 'Отменить';
                        break;
                    case 'processing':
                        processBtn.style.display = 'none';
                        completeBtn.style.display = 'inline-flex';
                        cancelBtn.textContent = 'Отменить';
                        break;
                    case 'completed':
                        processBtn.style.display = 'none';
                        completeBtn.style.display = 'none';
                        cancelBtn.textContent = 'Удалить';
                        break;
                    case 'cancelled':
                        processBtn.style.display = 'none';
                        completeBtn.style.display = 'none';
                        cancelBtn.textContent = 'Удалить';
                        break;
                }
            }
            
            closeModal() {
                document.getElementById('order-modal').style.display = 'none';
                this.currentOrder = null;
            }
            
            updateOrderStatus(newStatus, orderId = null) {
                const targetOrderId = orderId || this.currentOrder?.id;
                if (!targetOrderId) return;
                
                if (this.db.updateOrderStatus(targetOrderId, newStatus)) {
                    this.showNotification(`Статус заказа ${targetOrderId} изменен на "${this.getStatusText(newStatus)}"`, 'success');
                    this.loadOrders();
                    
                    if (this.currentOrder) {
                        this.showOrderDetails(targetOrderId);
                    }
                }
            }
            
            cancelOrder() {
                if (!this.currentOrder) return;
                
                if (this.currentOrder.status === 'completed' || this.currentOrder.status === 'cancelled') {
                    // Delete order
                    if (confirm('Удалить этот заказ?')) {
                        this.db.deleteOrder(this.currentOrder.id);
                        this.showNotification(`Заказ ${this.currentOrder.id} удален`, 'success');
                        this.closeModal();
                        this.loadOrders();
                    }
                } else {
                    // Cancel order
                    if (confirm('Отменить этот заказ?')) {
                        this.updateOrderStatus('cancelled');
                    }
                }
            }
            
            printOrder() {
                window.print();
            }
            
            getStatusText(status) {
                const statusMap = {
                    'pending': 'Ожидает',
                    'processing': 'В обработке',
                    'completed': 'Завершен',
                    'cancelled': 'Отменен'
                };
                return statusMap[status] || status;
            }
            
            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                const notificationIcon = document.getElementById('notification-icon');
                const notificationText = document.getElementById('notification-text');
                
                // Set icon based on type
                switch (type) {
                    case 'success':
                        notificationIcon.className = 'fas fa-check-circle';
                        break;
                    case 'error':
                        notificationIcon.className = 'fas fa-exclamation-circle';
                        break;
                    case 'warning':
                        notificationIcon.className = 'fas fa-exclamation-triangle';
                        break;
                }
                
                notificationText.textContent = message;
                notification.className = `notification show ${type}`;
                
                // Auto hide
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }

        // Initialize admin panel when page loads
        document.addEventListener('DOMContentLoaded', () => {
            const adminPanel = new AdminPanel();
            
            // Expose to window for debugging
            window.adminPanel = adminPanel;
        });

        // This function should be called from the cart page when order is placed
        // For demonstration, we'll simulate receiving an order
        function simulateNewOrder() {
            const db = new OrderDatabase();
            const mockOrderData = {
                name: 'Новый клиент',
                phone: '+7 (999) 123-45-67',
                email: 'new@example.com',
                address: 'Новый адрес доставки',
                items: [
                    { id: 2, name: 'Календарь "Праздничные узоры"', price: 10499, quantity: 1, color: '#C62828' }
                ],
                total: 10499,
                comment: 'Тестовый заказ'
            };
            
            const orderId = db.addOrder(mockOrderData);
            
            // Show notification in admin panel
            if (window.adminPanel) {
                window.adminPanel.showNotification(`Новый заказ: ${orderId}`, 'success');
                window.adminPanel.loadOrders();
            }
        }

        // Simulate receiving new orders periodically (for demo)
        setInterval(() => {
            if (Math.random() > 0.8) { // 20% chance every 10 seconds
                simulateNewOrder();
            }
        }, 10000);
    </script>
</body>
</html>